import{d as N}from"./eowDyVTy.js";import{u as I}from"./C7YCVWHz.js";import{q as s,j as T,V as $}from"#entry";function A(e){const i=atob(e);return Uint8Array.from(i,a=>a.codePointAt(0))}function x(e){const i=String.fromCodePoint(...e);return btoa(i)}function C(e){return x(new TextEncoder().encode(e))}function U(e){return new TextDecoder().decode(A(e))}function O(e){try{return e.split("~").map(i=>JSON.parse(U(i)))}catch(i){return console.error("Error parsing disclosures:",i),[]}}function W(e){return C(JSON.stringify(e)).replaceAll("=","")}function k(e){if(typeof e!="string")return e;if(!e.includes("."))try{return JSON.parse(e)}catch{return e}var i=e.split(".")[1];if(!i)return e;var a=i.replace(/-/g,"+").replace(/_/g,"/"),t=decodeURIComponent(window.atob(a).split("").map(function(u){return"%"+("00"+u.charCodeAt(0).toString(16)).slice(-2)}).join(""));try{return JSON.parse(t)}catch{return t}}function Z(e){const i=I(),a=N(async()=>{if(e.value){if(e.value.parsedDocument)return e.value.parsedDocument;let c;return e.value.format&&e.value.format==="mso_mdoc"?c=await(await fetch("/wallet-api/util/parseMDoc",{method:"POST",body:e.value.document})).json():c=k(e.value.document),c.vc?c.vc:c}else return null}),t=s(()=>e.value&&e.value.disclosures?O(e.value.disclosures):null),u=s(()=>e.value?.manifest&&e.value.manifest!="{}"?typeof e.value.manifest=="string"?JSON.parse(e.value.manifest):e.value.manifest:e.value?.parsedDocument?.display?.[0]??null),v=s(()=>u.value?.display?.claims);async function m(c){try{return(await(await fetch(`/wallet-api/wallet/${i.value}/exchange/resolveVctUrl?vct=${c}`)).json()).name||null}catch(f){return console.error("Error fetching VCT name:",f),null}}const o=T("");$(async()=>{if(a.value?.vct){const c=a.value.vct;o.value=await m(c)}else o.value=u.value?.display?.title??a.value?.type?.at(-1)?.replace(/([a-z0-9])([A-Z])/g,"$1 $2")??a.value?.vct?.replace("_vc+sd-jwt","").replace(/([a-z0-9])([A-Z])/g,"$1 $2")??a.value?.docType});const d=s(()=>u.value?.display?.card?.description??a.value?.name),p=s(()=>u.value?.display?.card?.logo?.uri??a.value?.issuer?.image?.id??a.value?.issuer?.image),l=s(()=>u.value?.display?.card?.issuedBy??a.value?.issuer?.name),n=s(()=>a.value?.issuer?.image?.id??a.value?.issuer?.image),g=s(()=>u.value?.input?.issuer??a.value?.issuer?.id??a.value?.issuer),D=s(()=>e.value.format==="vc+sd-jwt"?a.value?.iss??null:null),h=s(()=>u.value?.input?.credentialIssuer),w=s(()=>a.value?.expirationDate?new Date(a.value?.expirationDate).getTime()>new Date().getTime():a.value?.validUntil?new Date(a.value?.validUntil).getTime()>new Date().getTime():!0),S=s(()=>a.value?.issuanceDate?new Date(a.value?.issuanceDate).toISOString().slice(0,10):a.value?.validFrom?new Date(a.value?.validFrom).toISOString().slice(0,10):null),j=s(()=>a.value?.expirationDate?new Date(a.value?.expirationDate).toISOString().slice(0,10):a.value?.validUntil?new Date(a.value?.validUntil).toISOString().slice(0,10):null);return{jwtJson:a,disclosures:t,manifest:u,manifestClaims:v,titleTitelized:o,credentialSubtitle:d,credentialImageUrl:p,issuerName:l,issuerLogo:n,issuerDid:g,issuerKid:D,credentialIssuerService:h,isNotExpired:w,issuanceDate:S,expirationDate:j}}function r(e){return e==null?null:typeof e=="string"?e:typeof e=="number"||typeof e=="boolean"?String(e):null}function B(e){const i=e?.type??e?.vc?.type??e?._credential?.type??e?.credential?.type;if(Array.isArray(i))return r(i.at(-1));const a=r(i);if(a)return a;const t=r(e?.vct??e?.vc?.vct);return t?(t.split("/").at(-1)??t).replace("_vc+sd-jwt","").replace(/[^a-zA-Z0-9_-]/g,"")||t:null}function E(e){return e?e.replace(/Credential$/i,"").replace(/VC$/i,"").replace(/_/g,"").toLowerCase():""}function q(e){const i=e?.credentialSubject??e?.claims??e?.vc?.credentialSubject??e?.vc?.claims??e;return i?.claims&&typeof i.claims=="object"?{...i,...i.claims}:i}function z(e){const i=e?.issuer;return typeof i=="string"?i:r(i?.name)??r(i?.id)??null}function J(e){return r(e?.issuanceDate)??r(e?.validFrom)??null}function P(e){return r(e?.expirationDate)??r(e?.validUntil)??null}function b(e,i){const a=r(e),t=r(i);return!a&&!t?null:a&&t?`${a} ${t}`:a??t}function y(e){return e?Array.isArray(e)?e:[]:[]}function K(e){const i=B(e)??"Credential",a=E(i),t=q(e),u=z(e),v=J(e),m=P(e),o=[v?`Issued ${v.slice(0,10)}`:null,u].filter(Boolean);if(a==="genericid"||a==="identity")return{kind:"identity",title:r(t?.fullName)??r(t?.holderName)??"Identity Credential",subtitle:o.join(" · ")||void 0,fields:[{label:"Document #",value:t?.documentNumber??t?.credentialId??e?.id},{label:"Date of birth",value:t?.dateOfBirth},{label:"Nationality",value:t?.nationality},{label:"Expires",value:r(t?.expiryDate)??(m?m.slice(0,10):null)}].filter(l=>l.value!==null&&l.value!==void 0&&l.value!=="")};if(a==="paymentreceipt"||a==="receipt"){const l=b(t?.amount,t?.currency);return{kind:"receipt",title:r(t?.merchantName)??"Payment Receipt",subtitle:o.join(" · ")||void 0,fields:[{label:"Amount",value:l},{label:"Transaction ID",value:t?.transactionId},{label:"Method",value:t?.paymentMethod},{label:"When",value:t?.timestamp},{label:"Description",value:t?.description}].filter(n=>n.value!==null&&n.value!==void 0&&n.value!=="")}}if(a==="openbadge")return{kind:"badge",title:r(t?.badgeName)??"OpenBadge",subtitle:o.join(" · ")||void 0,fields:[{label:"Achievement",value:t?.achievementType},{label:"Date",value:t?.achievementDate},{label:"Issuer",value:t?.issuerName??u}].filter(l=>l.value!==null&&l.value!==void 0&&l.value!=="")};if(a==="diploma")return{kind:"diploma",title:r(t?.fullName)??"Diploma",subtitle:o.join(" · ")||void 0,fields:[{label:"Degree",value:t?.degree},{label:"Honours",value:t?.honours},{label:"Graduated",value:t?.graduationDate}].filter(l=>l.value!==null&&l.value!==void 0&&l.value!=="")};if(a==="invoice"){const l=y(t?.items);return{kind:"invoice",title:`Invoice${t?.invoiceNumber?` #${t.invoiceNumber}`:t?.invoiceId?` #${t.invoiceId}`:""}`,subtitle:o.join(" · ")||void 0,fields:[{label:"From",value:u},{label:"To",value:r(t?.holderName)??r(t?.customerName)??r(e?.holder?.name)??null},{label:"Date",value:t?.date??t?.timestamp},{label:"Total",value:t?.total??t?.amount}].filter(n=>n.value!==null&&n.value!==void 0&&n.value!==""),table:l.length?{headers:["Description","Amount"],rows:l.map(n=>({description:n?.description,amount:n?.amount}))}:void 0}}if(a==="quote"){const l=y(t?.lines);return{kind:"quote",title:`Quote${t?.quoteNumber?` #${t.quoteNumber}`:t?.quoteId?` #${t.quoteId}`:""}`,subtitle:o.join(" · ")||void 0,fields:[{label:"From",value:u},{label:"To",value:r(t?.holderName)??r(t?.customerName)??r(e?.holder?.name)??null},{label:"Valid until",value:t?.validUntil},{label:"Estimated total",value:t?.estimatedTotal}].filter(n=>n.value!==null&&n.value!==void 0&&n.value!==""),table:l.length?{headers:["Description","Amount"],rows:l.map(n=>({description:n?.description,amount:n?.amount}))}:void 0}}if(a==="catalogitem")return{kind:"catalog",title:r(t?.title)??r(t?.name)??"Catalog Item",subtitle:o.join(" · ")||void 0,fields:[{label:"SKU",value:t?.sku},{label:"Price",value:b(t?.price,t?.currency)},{label:"Merchant",value:t?.merchantId??t?.merchantDid},{label:"Description",value:t?.description}].filter(l=>l.value!==null&&l.value!==void 0&&l.value!=="")};const d=[],p=new Set(["id","type","@context","issuer","issuanceDate","expirationDate","proof","credentialSubjectIds","issuerId"]);if(t&&typeof t=="object")for(const[l,n]of Object.entries(t)){if(d.length>=8)break;p.has(l)||l.startsWith("@")||n==null||n===""||typeof n!="object"&&d.push({label:l,value:n})}return{kind:"generic",title:i.replace(/([a-z0-9])([A-Z])/g,"$1 $2"),subtitle:o.join(" · ")||void 0,fields:d}}export{O as a,W as e,K as g,k as p,Z as u};
