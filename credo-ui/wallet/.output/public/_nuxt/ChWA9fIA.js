import{_ as M}from"./D-q_bWm-.js";import{e as W}from"./D75GOWRg.js";import{u as G}from"./CS6oTbIc.js";import{x as r,l as x,U as K,k as H,c as b,o as y,n as Y,a as o,h as T,g as I,t as h,F as J,r as z,_ as X}from"#entry";function ee(t){const n=atob(t);return Uint8Array.from(n,e=>e.codePointAt(0))}function te(t){const n=String.fromCodePoint(...t);return btoa(n)}function ae(t){return te(new TextEncoder().encode(t))}function le(t){return new TextDecoder().decode(ee(t))}function ne(t){try{return t.split("~").map(n=>JSON.parse(le(n)))}catch(n){return console.error("Error parsing disclosures:",n),[]}}function ze(t){return ae(JSON.stringify(t)).replaceAll("=","")}function ie(t){if(typeof t!="string")return t;if(!t.includes("."))try{return JSON.parse(t)}catch{return t}var n=t.split(".")[1];if(!n)return t;var e=n.replace(/-/g,"+").replace(/_/g,"/"),u=decodeURIComponent(window.atob(e).split("").map(function(v){return"%"+("00"+v.charCodeAt(0).toString(16)).slice(-2)}).join(""));try{return JSON.parse(u)}catch{return u}}function se(t){const n=G(),e=W(async()=>{if(t.value){if(t.value.parsedDocument)return t.value.parsedDocument;let f;return t.value.format&&t.value.format==="mso_mdoc"?f=await(await fetch("/wallet-api/util/parseMDoc",{method:"POST",body:t.value.document})).json():f=ie(t.value.document),f.vc?f.vc:f}else return null}),u=r(()=>t.value&&t.value.disclosures?ne(t.value.disclosures):null),v=r(()=>t.value?.manifest&&t.value.manifest!="{}"?typeof t.value.manifest=="string"?JSON.parse(t.value.manifest):t.value.manifest:t.value?.parsedDocument?.display?.[0]??null),w=r(()=>v.value?.display?.claims);async function g(f){try{return(await(await fetch(`/wallet-api/wallet/${n.value}/exchange/resolveVctUrl?vct=${f}`)).json()).name||null}catch(N){return console.error("Error fetching VCT name:",N),null}}const _=x("");K(async()=>{if(e.value?.vct){const f=e.value.vct;_.value=await g(f)}else _.value=v.value?.display?.title??e.value?.type?.at(-1)?.replace(/([a-z0-9])([A-Z])/g,"$1 $2")??e.value?.vct?.replace("_vc+sd-jwt","").replace(/([a-z0-9])([A-Z])/g,"$1 $2")??e.value?.docType});const C=r(()=>v.value?.display?.card?.description??e.value?.name),s=r(()=>v.value?.display?.card?.logo?.uri??e.value?.issuer?.image?.id??e.value?.issuer?.image),i=r(()=>v.value?.display?.card?.issuedBy??e.value?.issuer?.name),k=r(()=>e.value?.issuer?.image?.id??e.value?.issuer?.image),U=r(()=>v.value?.input?.issuer??e.value?.issuer?.id??e.value?.issuer),j=r(()=>t.value.format==="vc+sd-jwt"?e.value?.iss??null:null),$=r(()=>v.value?.input?.credentialIssuer),O=r(()=>e.value?.expirationDate?new Date(e.value?.expirationDate).getTime()>new Date().getTime():e.value?.validUntil?new Date(e.value?.validUntil).getTime()>new Date().getTime():!0),A=r(()=>e.value?.issuanceDate?new Date(e.value?.issuanceDate).toISOString().slice(0,10):e.value?.validFrom?new Date(e.value?.validFrom).toISOString().slice(0,10):null),S=r(()=>e.value?.expirationDate?new Date(e.value?.expirationDate).toISOString().slice(0,10):e.value?.validUntil?new Date(e.value?.validUntil).toISOString().slice(0,10):null);return{jwtJson:e,disclosures:u,manifest:v,manifestClaims:w,titleTitelized:_,credentialSubtitle:C,credentialImageUrl:s,issuerName:i,issuerLogo:k,issuerDid:U,issuerKid:j,credentialIssuerService:$,isNotExpired:O,issuanceDate:A,expirationDate:S}}function c(t){return t==null?null:typeof t=="string"?t:typeof t=="number"||typeof t=="boolean"?String(t):null}function re(t){const n=t?.type??t?.vc?.type;if(Array.isArray(n))return c(n.at(-1));const e=c(n);if(e)return e;const u=c(t?.vct??t?.vc?.vct);return u?(u.split("/").at(-1)??u).replace("_vc+sd-jwt","").replace(/[^a-zA-Z0-9_-]/g,"")||u:null}function ue(t){return t?.credentialSubject??t?.claims??t?.vc?.credentialSubject??t?.vc?.claims??t}function oe(t){const n=t?.issuer;return typeof n=="string"?n:c(n?.name)??c(n?.id)??null}function ce(t){return c(t?.issuanceDate)??c(t?.validFrom)??null}function de(t){return c(t?.expirationDate)??c(t?.validUntil)??null}function ve(t,n){const e=c(t),u=c(n);return!e&&!u?null:e&&u?`${e} ${u}`:e??u}function P(t){return t?Array.isArray(t)?t:[]:[]}function me(t){const n=re(t)??"Credential",e=ue(t),u=oe(t),v=ce(t),w=de(t),g=[v?`Issued ${v.slice(0,10)}`:null,u].filter(Boolean);if(n==="GenericIDCredential"||n==="Identity"||n==="IdentityCredential")return{kind:"identity",title:c(e?.fullName)??c(e?.holderName)??"Identity Credential",subtitle:g.join(" · ")||void 0,fields:[{label:"Document #",value:e?.documentNumber??e?.credentialId??t?.id},{label:"Date of birth",value:e?.dateOfBirth},{label:"Nationality",value:e?.nationality},{label:"Expires",value:c(e?.expiryDate)??(w?w.slice(0,10):null)}].filter(s=>s.value!==null&&s.value!==void 0&&s.value!=="")};if(n==="PaymentReceipt"||n==="PaymentReceiptCredential"||n==="Receipt"){const s=ve(e?.amount,e?.currency);return{kind:"receipt",title:c(e?.merchantName)??"Payment Receipt",subtitle:g.join(" · ")||void 0,fields:[{label:"Amount",value:s},{label:"Transaction ID",value:e?.transactionId},{label:"Method",value:e?.paymentMethod},{label:"When",value:e?.timestamp},{label:"Description",value:e?.description}].filter(i=>i.value!==null&&i.value!==void 0&&i.value!=="")}}if(n==="OpenBadge")return{kind:"badge",title:c(e?.badgeName)??"OpenBadge",subtitle:g.join(" · ")||void 0,fields:[{label:"Achievement",value:e?.achievementType},{label:"Date",value:e?.achievementDate},{label:"Issuer",value:e?.issuerName??u}].filter(s=>s.value!==null&&s.value!==void 0&&s.value!=="")};if(n==="Diploma"||n==="DiplomaCredential")return{kind:"diploma",title:c(e?.fullName)??"Diploma",subtitle:g.join(" · ")||void 0,fields:[{label:"Degree",value:e?.degree},{label:"Honours",value:e?.honours},{label:"Graduated",value:e?.graduationDate}].filter(s=>s.value!==null&&s.value!==void 0&&s.value!=="")};if(n==="Invoice"||n==="InvoiceCredential"){const s=P(e?.items);return{kind:"invoice",title:`Invoice${e?.invoiceNumber?` #${e.invoiceNumber}`:""}`,subtitle:g.join(" · ")||void 0,fields:[{label:"From",value:u},{label:"To",value:c(e?.holderName)??c(t?.holder?.name)??null},{label:"Date",value:e?.date},{label:"Total",value:e?.total}].filter(i=>i.value!==null&&i.value!==void 0&&i.value!==""),table:s.length?{headers:["Description","Amount"],rows:s.map(i=>({description:i?.description,amount:i?.amount}))}:void 0}}if(n==="Quote"||n==="QuoteCredential"){const s=P(e?.lines);return{kind:"quote",title:`Quote${e?.quoteNumber?` #${e.quoteNumber}`:""}`,subtitle:g.join(" · ")||void 0,fields:[{label:"From",value:u},{label:"To",value:c(e?.holderName)??c(t?.holder?.name)??null},{label:"Valid until",value:e?.validUntil},{label:"Estimated total",value:e?.estimatedTotal}].filter(i=>i.value!==null&&i.value!==void 0&&i.value!==""),table:s.length?{headers:["Description","Amount"],rows:s.map(i=>({description:i?.description,amount:i?.amount}))}:void 0}}const _=[],C=new Set(["id","type","@context","issuer","issuanceDate","expirationDate","proof","credentialSubjectIds","issuerId"]);if(e&&typeof e=="object")for(const[s,i]of Object.entries(e)){if(_.length>=8)break;C.has(s)||s.startsWith("@")||i==null||i===""||typeof i!="object"&&_.push({label:s,value:i})}return{kind:"generic",title:n.replace(/([a-z0-9])([A-Z])/g,"$1 $2"),subtitle:g.join(" · ")||void 0,fields:_}}const pe={class:"card-header"},fe={class:"issuer-brand"},be=["src"],ye={key:1,src:M,alt:"Credentis",class:"brand-logo"},ge={class:"brand-name"},he={key:0,class:"verified-badge"},De={key:1,class:"expired-badge"},_e={class:"card-title-section"},Ce={class:"card-title"},we={class:"holder-name"},Ie={class:"subtitle-row"},je={class:"issued-info"},Ne={class:"type-badge"},Se={key:0,class:"claims-section"},ke={class:"claim-label"},Ae={class:"claim-value"},Te={key:1,class:"line-items-section"},xe={class:"item-description"},Ue={class:"item-amount"},$e={key:0,class:"total-row"},Oe={class:"total-value"},Ve={key:2,class:"credential-id"},qe=H({__name:"VerifiableCredentialCard",props:{credential:{type:Object,required:!0},showId:{type:Boolean,required:!1,default:!1},isDetailView:{type:Boolean,required:!1,default:!1}},setup(t){const n=t,{jwtJson:e,titleTitelized:u,isNotExpired:v,issuerName:w,issuerLogo:g,issuanceDate:_}=se(x(n.credential)),C=x(n.isDetailView??!1),s=x(null),i=r(()=>e.value?me(e.value):null),k=r(()=>{const l=i.value?.kind||"generic";return l.charAt(0).toUpperCase()+l.slice(1)}),U=r(()=>{const l=k.value;return l==="Generic"?u.value||"Credential":`${l} Credential`}),j=l=>{if(!l)return{};let a=l?.credentialSubject??l?.vc?.credentialSubject??l?.additionalClaims?.vc?.credentialSubject??{};return a?.claims&&typeof a.claims=="object"&&(a={...a,...a.claims}),a},$=r(()=>{const l=e.value;if(!l)return"";const a=j(l);return a?.fullName??a?.holderName??a?.name??a?.customerName??l?.holder?.name??""}),O=r(()=>_.value?_.value:"Unknown"),A=r(()=>{const l=e.value;if(!l)return[];const a=j(l);console.log("[VC Card] credentialSubject:",a);const d=l?.type??l?.vc?.type??[],D=i.value?.kind==="invoice"||d.some(p=>p?.toLowerCase().includes("invoice"))||a?.invoiceId||a?.invoiceNumber,L=i.value?.kind==="quote"||d.some(p=>p?.toLowerCase().includes("quote"))||a?.quoteId||a?.quoteNumber;if(D){const p=[{label:"Invoice ID",value:a?.invoiceId??a?.invoiceNumber??a?.invoice_number},{label:"Cart Reference",value:a?.cartRef??a?.cartReference},{label:"Amount",value:S(a?.amount??a?.total??a?.totalAmount,a?.currency)},{label:"Currency",value:a?.currency?.toUpperCase()},{label:"Due Date",value:f(a?.dueDate??a?.due_date)},{label:"Issued",value:f(a?.timestamp??a?.issuedAt)}].filter(m=>m.value!=null&&m.value!==""&&m.value!=="—");return C.value?p:p.slice(0,4)}if(L){const p=[{label:"Quote ID",value:a?.quoteId??a?.quoteNumber??a?.quote_number},{label:"Customer",value:a?.customerName??a?.customer_name??a?.name},{label:"Total",value:S(a?.totalAmount??a?.total_amount??a?.amount,a?.currency)},{label:"Currency",value:a?.currency?.toUpperCase()},{label:"Valid Until",value:f(a?.validUntil??a?.valid_until)}].filter(m=>m.value!=null&&m.value!==""&&m.value!=="—");return C.value?p:p.slice(0,4)}if(i.value?.fields&&i.value.fields.length>0){const p=i.value.fields;return C.value?p:p.slice(0,4)}const Q=["id","claims","type","@context"],V=[];for(const[p,m]of Object.entries(a)){if(Q.includes(p)||m==null||typeof m=="object"&&!Array.isArray(m))continue;const Z=p.replace(/([A-Z])/g," $1").replace(/_/g," ").trim().split(" ").map(E=>E.charAt(0).toUpperCase()+E.slice(1)).join(" ");let F=m;typeof m=="string"&&m.match(/^\d{4}-\d{2}-\d{2}/)&&(F=f(m)),V.push({label:Z,value:F})}return C.value?V:V.slice(0,4)}),S=(l,a)=>{if(l==null)return null;const d=a?.toUpperCase()??"USD";return typeof l=="number"?`${d} ${l.toFixed(2)}`:`${d} ${l}`},f=l=>{if(!l)return null;try{return new Date(l).toISOString().slice(0,10)}catch{return String(l)}},N=r(()=>{const l=e.value;if(!l)return[];const a=j(l),d=a?.items??a?.lines??a?.lineItems??[];return Array.isArray(d)?d.map(D=>({description:D?.description??D?.name??"—",amount:S(D?.amount??D?.price,a?.currency)??"—"})):[]}),q=r(()=>N.value.length>0&&(i.value?.kind==="invoice"||i.value?.kind==="quote")),B=r(()=>{const l=e.value;if(!l)return null;const a=j(l),d=a?.total??a?.estimatedTotal??a?.totalAmount??a?.amount,D=(a?.currency??"USD").toUpperCase();return d==null?null:typeof d=="number"?`${D} ${d.toFixed(2)}`:`${D} ${d}`}),R=l=>l==null?"—":Array.isArray(l)?l.map(a=>typeof a=="object"?JSON.stringify(a):String(a)).join(", "):typeof l=="boolean"?l?"Yes":"No":typeof l=="object"?JSON.stringify(l):String(l);return(l,a)=>(y(),b("div",{ref_key:"vcCardDiv",ref:s,class:Y(["credential-card",{"detail-view":C.value}])},[o("div",pe,[o("div",fe,[I(g)?(y(),b("img",{key:0,src:I(g),alt:"Issuer",class:"brand-logo"},null,8,be)):(y(),b("img",ye)),o("span",ge,h(I(w)||"Credentis"),1)]),I(v)?(y(),b("div",he,"Verified")):(y(),b("div",De,"Expired"))]),o("div",_e,[o("h2",Ce,h(U.value),1),o("div",we,h($.value),1),o("div",Ie,[o("span",je,"Issued "+h(O.value)+" · "+h(I(w)||"Unknown Issuer"),1),o("span",Ne,h(k.value),1)])]),a[4]||(a[4]=o("div",{class:"card-divider"},null,-1)),A.value.length>0?(y(),b("div",Se,[(y(!0),b(J,null,z(A.value,d=>(y(),b("div",{key:d.label,class:"claim-row"},[o("span",ke,h(d.label),1),o("span",Ae,h(R(d.value)),1)]))),128))])):T("",!0),q.value?(y(),b("div",Te,[a[1]||(a[1]=o("div",{class:"line-items-divider"},null,-1)),a[2]||(a[2]=o("div",{class:"line-items-header"},[o("span",null,"Description"),o("span",null,"Amount")],-1)),(y(!0),b(J,null,z(N.value,(d,D)=>(y(),b("div",{key:D,class:"line-item-row"},[o("span",xe,h(d.description),1),o("span",Ue,h(d.amount),1)]))),128)),a[3]||(a[3]=o("div",{class:"line-items-divider"},null,-1)),B.value?(y(),b("div",$e,[a[0]||(a[0]=o("span",{class:"total-label"},"Total",-1)),o("span",Oe,h(B.value),1)])):T("",!0)])):T("",!0),t.showId&&I(e)?.id?(y(),b("div",Ve," ID: "+h(I(e).id),1)):T("",!0)],2))}}),Pe=X(qe,[["__scopeId","data-v-8b704f15"]]);export{Pe as V,ne as a,ze as e,ie as p,se as u};
