import{e as $}from"./D75GOWRg.js";import{u as U}from"./CS6oTbIc.js";import{x as u,l as j,U as B,k as E,c as y,o as g,n as N,g as d,h as I,a as o,t as x,F as T,r as A}from"#entry";function V(t){const a=atob(t);return Uint8Array.from(a,e=>e.codePointAt(0))}function F(t){const a=String.fromCodePoint(...t);return btoa(a)}function J(t){return F(new TextEncoder().encode(t))}function P(t){return new TextDecoder().decode(V(t))}function z(t){try{return t.split("~").map(a=>JSON.parse(P(a)))}catch(a){return console.error("Error parsing disclosures:",a),[]}}function be(t){return J(JSON.stringify(t)).replaceAll("=","")}function q(t){if(typeof t!="string")return t;if(!t.includes("."))try{return JSON.parse(t)}catch{return t}var a=t.split(".")[1];if(!a)return t;var e=a.replace(/-/g,"+").replace(/_/g,"/"),s=decodeURIComponent(window.atob(e).split("").map(function(r){return"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)}).join(""));try{return JSON.parse(s)}catch{return s}}function L(t){const a=U(),e=$(async()=>{if(t.value){if(t.value.parsedDocument)return t.value.parsedDocument;let m;return t.value.format&&t.value.format==="mso_mdoc"?m=await(await fetch("/wallet-api/util/parseMDoc",{method:"POST",body:t.value.document})).json():m=q(t.value.document),m.vc?m.vc:m}else return null}),s=u(()=>t.value&&t.value.disclosures?z(t.value.disclosures):null),r=u(()=>t.value?.manifest&&t.value.manifest!="{}"?typeof t.value.manifest=="string"?JSON.parse(t.value.manifest):t.value.manifest:t.value?.parsedDocument?.display?.[0]??null),f=u(()=>r.value?.display?.claims);async function v(m){try{return(await(await fetch(`/wallet-api/wallet/${a.value}/exchange/resolveVctUrl?vct=${m}`)).json()).name||null}catch(C){return console.error("Error fetching VCT name:",C),null}}const p=j("");B(async()=>{if(e.value?.vct){const m=e.value.vct;p.value=await v(m)}else p.value=r.value?.display?.title??e.value?.type?.at(-1)?.replace(/([a-z0-9])([A-Z])/g,"$1 $2")??e.value?.vct?.replace("_vc+sd-jwt","").replace(/([a-z0-9])([A-Z])/g,"$1 $2")??e.value?.docType});const h=u(()=>r.value?.display?.card?.description??e.value?.name),i=u(()=>r.value?.display?.card?.logo?.uri??e.value?.issuer?.image?.id??e.value?.issuer?.image),l=u(()=>r.value?.display?.card?.issuedBy??e.value?.issuer?.name),S=u(()=>e.value?.issuer?.image?.id??e.value?.issuer?.image),k=u(()=>r.value?.input?.issuer??e.value?.issuer?.id??e.value?.issuer),w=u(()=>t.value.format==="vc+sd-jwt"?e.value?.iss??null:null),_=u(()=>r.value?.input?.credentialIssuer),c=u(()=>e.value?.expirationDate?new Date(e.value?.expirationDate).getTime()>new Date().getTime():e.value?.validUntil?new Date(e.value?.validUntil).getTime()>new Date().getTime():!0),b=u(()=>e.value?.issuanceDate?new Date(e.value?.issuanceDate).toISOString().slice(0,10):e.value?.validFrom?new Date(e.value?.validFrom).toISOString().slice(0,10):null),D=u(()=>e.value?.expirationDate?new Date(e.value?.expirationDate).toISOString().slice(0,10):e.value?.validUntil?new Date(e.value?.validUntil).toISOString().slice(0,10):null);return{jwtJson:e,disclosures:s,manifest:r,manifestClaims:f,titleTitelized:p,credentialSubtitle:h,credentialImageUrl:i,issuerName:l,issuerLogo:S,issuerDid:k,issuerKid:w,credentialIssuerService:_,isNotExpired:c,issuanceDate:b,expirationDate:D}}function n(t){return t==null?null:typeof t=="string"?t:typeof t=="number"||typeof t=="boolean"?String(t):null}function R(t){const a=t?.type;return Array.isArray(a)?n(a.at(-1)):n(a)}function M(t){return t?.credentialSubject??t?.claims??t}function W(t){const a=t?.issuer;return typeof a=="string"?a:n(a?.name)??n(a?.id)??null}function Q(t){return n(t?.issuanceDate)??n(t?.validFrom)??null}function Z(t){return n(t?.expirationDate)??n(t?.validUntil)??null}function G(t,a){const e=n(t),s=n(a);return!e&&!s?null:e&&s?`${e} ${s}`:e??s}function O(t){return t?Array.isArray(t)?t:[]:[]}function H(t){const a=R(t)??"Credential",e=M(t),s=W(t),r=Q(t),f=Z(t),v=[r?`Issued ${r.slice(0,10)}`:null,s].filter(Boolean);if(a==="GenericIDCredential"||a==="Identity"||a==="IdentityCredential")return{kind:"identity",title:n(e?.fullName)??n(e?.holderName)??"Identity Credential",subtitle:v.join(" · ")||void 0,fields:[{label:"Document #",value:e?.documentNumber??e?.credentialId??t?.id},{label:"Date of birth",value:e?.dateOfBirth},{label:"Nationality",value:e?.nationality},{label:"Expires",value:n(e?.expiryDate)??(f?f.slice(0,10):null)}].filter(i=>i.value!==null&&i.value!==void 0&&i.value!=="")};if(a==="PaymentReceipt"||a==="PaymentReceiptCredential"||a==="Receipt"){const i=G(e?.amount,e?.currency);return{kind:"receipt",title:n(e?.merchantName)??"Payment Receipt",subtitle:v.join(" · ")||void 0,fields:[{label:"Amount",value:i},{label:"Transaction ID",value:e?.transactionId},{label:"Method",value:e?.paymentMethod},{label:"When",value:e?.timestamp},{label:"Description",value:e?.description}].filter(l=>l.value!==null&&l.value!==void 0&&l.value!=="")}}if(a==="OpenBadge")return{kind:"badge",title:n(e?.badgeName)??"OpenBadge",subtitle:v.join(" · ")||void 0,fields:[{label:"Achievement",value:e?.achievementType},{label:"Date",value:e?.achievementDate},{label:"Issuer",value:e?.issuerName??s}].filter(i=>i.value!==null&&i.value!==void 0&&i.value!=="")};if(a==="Diploma"||a==="DiplomaCredential")return{kind:"diploma",title:n(e?.fullName)??"Diploma",subtitle:v.join(" · ")||void 0,fields:[{label:"Degree",value:e?.degree},{label:"Honours",value:e?.honours},{label:"Graduated",value:e?.graduationDate}].filter(i=>i.value!==null&&i.value!==void 0&&i.value!=="")};if(a==="Invoice"||a==="InvoiceCredential"){const i=O(e?.items);return{kind:"invoice",title:`Invoice${e?.invoiceNumber?` #${e.invoiceNumber}`:""}`,subtitle:v.join(" · ")||void 0,fields:[{label:"From",value:s},{label:"To",value:n(e?.holderName)??n(t?.holder?.name)??null},{label:"Date",value:e?.date},{label:"Total",value:e?.total}].filter(l=>l.value!==null&&l.value!==void 0&&l.value!==""),table:i.length?{headers:["Description","Amount"],rows:i.map(l=>({description:l?.description,amount:l?.amount}))}:void 0}}if(a==="Quote"||a==="QuoteCredential"){const i=O(e?.lines);return{kind:"quote",title:`Quote${e?.quoteNumber?` #${e.quoteNumber}`:""}`,subtitle:v.join(" · ")||void 0,fields:[{label:"From",value:s},{label:"To",value:n(e?.holderName)??n(t?.holder?.name)??null},{label:"Valid until",value:e?.validUntil},{label:"Estimated total",value:e?.estimatedTotal}].filter(l=>l.value!==null&&l.value!==void 0&&l.value!==""),table:i.length?{headers:["Description","Amount"],rows:i.map(l=>({description:l?.description,amount:l?.amount}))}:void 0}}const p=[],h=new Set(["id","type","@context","issuer","issuanceDate","expirationDate","proof","credentialSubjectIds","issuerId"]);if(e&&typeof e=="object")for(const[i,l]of Object.entries(e)){if(p.length>=8)break;h.has(i)||i.startsWith("@")||l==null||l===""||typeof l!="object"&&p.push({label:i,value:l})}return{kind:"generic",title:a.replace(/([a-z0-9])([A-Z])/g,"$1 $2"),subtitle:v.join(" · ")||void 0,fields:p}}const K={key:0,class:"flex justify-end"},Y={class:"mb-4"},X={class:"text-2xl font-bold bold"},ee={key:1,class:"mb-4 space-y-1"},te={class:"opacity-75"},ae={class:"font-medium truncate ml-2 max-w-[180px]"},le={key:2,class:"mb-4 mt-2"},ie={class:"bg-white/10 rounded-xl p-3"},ne={class:"grid grid-cols-2 text-xs font-bold opacity-80 mb-2"},se={class:"text-right"},re={class:"truncate pr-2"},oe={class:"text-right"},ue={class:"flex justify-between items-end gap-2"},ce=["src"],de={key:3,class:"font-mono mt-3 text-xs opacity-75"},ye=E({__name:"VerifiableCredentialCard",props:{credential:{type:Object,required:!0},showId:{type:Boolean,required:!1,default:!1},isDetailView:{type:Boolean,required:!1,default:!1}},setup(t){const a=t,{jwtJson:e,manifest:s,titleTitelized:r,isNotExpired:f,issuerName:v,issuerLogo:p}=L(j(a.credential)),h=u(()=>s.value?.display?.card??s.value),i=j(a.isDetailView??!1),l=j(null),S=u(()=>e.value?H(e.value):null),k=u(()=>{const c=S.value?.fields??[];return i.value?c:c.slice(0,5)}),w=u(()=>S.value?.table??null),_=c=>c==null?"":Array.isArray(c)?c.map(b=>typeof b=="object"?JSON.stringify(b):String(b)).join(", "):typeof c=="boolean"?c?"Yes":"No":typeof c=="object"?JSON.stringify(c):String(c);return B(async()=>{try{l.value&&h.value&&(s.value.backgroundImage?(l.value.style.backgroundImage=`url(${s.value.backgroundImage.url})`,l.value.style.backgroundSize="cover",l.value.style.backgroundPosition="center"):h.value.backgroundColor&&(l.value.style.background=h.value.backgroundColor),h.value.textColor&&(l.value.style.color=h.value.textColor))}catch{}}),(c,b)=>(g(),y("div",{ref_key:"vcCardDiv",ref:l,class:N({"p-6 rounded-2xl shadow-2xl sm:shadow-lg h-full text-white":!0,"lg:w-[400px]":i.value,"bg-gradient-to-br from-[#0573F0] to-[#03449E] border-t-white border-t-[0.5px]":d(f),"bg-[#7B8794]":!d(f)})},[d(f)?I("",!0):(g(),y("div",K,[...b[0]||(b[0]=[o("div",{class:"text-black bg-[#CBD2D9] px-2 py-1 rounded-full text-xs"},"Expired",-1)])])),o("div",Y,[o("div",X,x(i.value?d(r):d(r)?.length>20?d(r)?.slice(0,20)+"...":d(r)),1)]),k.value.length>0?(g(),y("div",ee,[(g(!0),y(T,null,A(k.value,D=>(g(),y("div",{key:D.label,class:"flex justify-between text-sm"},[o("span",te,x(D.label)+":",1),o("span",ae,x(_(D.value)),1)]))),128))])):I("",!0),i.value&&w.value?(g(),y("div",le,[b[1]||(b[1]=o("div",{class:"text-xs opacity-75 mb-2"},"Line items",-1)),o("div",ie,[o("div",ne,[o("div",null,x(w.value.headers[0]),1),o("div",se,x(w.value.headers[1]),1)]),(g(!0),y(T,null,A(w.value.rows,(D,m)=>(g(),y("div",{key:m,class:"grid grid-cols-2 text-sm py-1"},[o("div",re,x(_(D.description)),1),o("div",oe,x(_(D.amount)),1)]))),128))])])):I("",!0),o("div",{class:N({"sm:mt-4":d(f),"sm:mt-2":!d(f)})},[o("div",ue,[o("div",null,[o("div",{class:N([{"text-[#0573f000]":!d(v)},"text-xs opacity-75"])},"Issuer",2),o("div",{class:N([{"text-[#0573f000]":!d(v)},"font-bold text-sm"])},x(d(v)??"Unknown"),3)]),d(p)?(g(),y("img",{key:0,src:d(p),alt:"Issuer Logo",class:"h-6 rounded-full"},null,8,ce)):I("",!0)])],2),t.showId?(g(),y("div",de,"ID: "+x(d(e)?.id),1)):I("",!0)],2))}});export{ye as _,z as a,be as e,q as p,L as u};
